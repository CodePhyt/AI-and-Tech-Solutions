// Osman Kadir KI & Tech Solutions â€” Database Schema
// Prisma Schema for Lead Management & Chat

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Lead {
  id          String   @id @default(cuid())
  name        String?
  email       String?  @unique
  phone       String?
  whatsapp    String?
  service     String?  // e.g. "ai-software", "smart-home"
  message     String?
  sentiment   String?  // "HOT" or "COLD"
  source      String?  // "chat", "contact_form", "booking_api", "assessment"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  chatSessions ChatSession[]

  @@index([createdAt])
  @@index([sentiment])
}

model BlogPost {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  excerpt     String
  content     String
  category    String   // "tech", "ai", "case-study"
  imageUrl    String
  published   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([published])
}

model ChatSession {
  id        String    @id @default(cuid())
  userToken String?   @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  messages  Message[]

  leadId    String?
  Lead      Lead?     @relation(fields: [leadId], references: [id])
}

model Message {
  id            String      @id @default(cuid())
  role          String
  content       String
  image         String?
  createdAt     DateTime    @default(now())

  chatSessionId String
  ChatSession   ChatSession @relation(fields: [chatSessionId], references: [id])
}
